#!/usr/bin/env luajit

package.path = './?.lua;' .. package.path
local sys_config = require 'lor.scaffold.config'
local lor = require 'lor.scaffold.lor'
local generator = require 'lor.scaffold.generator'
local utils = require 'lor.lib.utils'

-- LOR_CONTEXT should be the only global app variable.
LOR_CONTEXT = {
	version = sys_config.version,
	debug = false
} 

local usages = [[lor v]] .. LOR_CONTEXT.version .. [[, a Lua web framework based on OpenResty.

Usage: lor COMMAND [OPTIONS]

Commands:
 new [name]             Create a new application
 start                  Starts the server
 stop                   Stops the server
 restart                Restart the server
 version                Show version of lor
 help                   Show help tips

Options:
 --debug                Show some runtime details
]]


-- if debug?
if arg[#arg] == '--debug' then
  table.remove(arg, #arg)
  LOR_CONTEXT.debug = true
end

-- parse commands and options
if arg[1] == 'new' and arg[2] then 
	generator.new(arg[2]) -- generate example code
elseif arg[1] == 'start' then 
	lor.start() -- start application
elseif arg[1] == 'stop' then 
	lor.stop() -- stop application
elseif arg[1] == 'restart' then
	lor.stop()
	lor.start()
elseif arg[1] == 'context' or arg[1] == '-c' then
	utils.print(LOR_CONTEXT) -- show global lor context
elseif arg[1] == 'help' or arg[1] == '-h' then
	print(usages)
elseif arg[1] == 'version' or arg[1] == '-v' then
	print(LOR_CONTEXT.version) -- show lor framework version
else 
	print("[lor] unsupported commands or options")
end


